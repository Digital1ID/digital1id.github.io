<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>JW Player</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="//content.jwplatform.com/libraries/SAHhwvZq.js"></script>
  <style>
    body { margin: 0; }
    #jwplayerDiv {
      aspect-ratio: 16/9;
      max-width: 854px;
      width: 100%;
      margin: 0 auto;
    }
    #debug-log {
      white-space: pre-wrap;
      max-height: 200px;
      overflow-y: auto;
    }
  </style>
</head>
<body class="bg-gray-900 text-white">

  <main class="container mx-auto px-4 mt-8 mb-16">
    <div id="jwplayerDiv"></div>
    <h2 id="movie-title" class="text-2xl font-bold mt-4 mb-4 text-blue-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</h2>
    <p id="error-message" class="text-red-500 mt-4 hidden">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</p>

    <button onclick="toggleDebug()" class="bg-yellow-500 px-4 py-2 rounded mt-4">Toggle Debug</button>
    <pre id="debug-log" class="bg-black text-green-400 p-2 mt-2 hidden"></pre>
  </main>

<script>
  function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
  }

  function buildSimulatedPlaylist(metaID) {
    return `#EXTM3U
#EXT-X-VERSION:3
#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="aac",LANGUAGE="eng",NAME="ENG",DEFAULT=YES,AUTOSELECT=YES,URI="https://statics-01.duckduckcdn.com/${metaID}/audio-eng/audio.m3u8"
#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="aac",LANGUAGE="tha",NAME="THA",DEFAULT=NO,AUTOSELECT=NO,URI="https://statics-01.duckduckcdn.com/${metaID}/audio-tha/audio.m3u8"
#EXT-X-STREAM-INF:BANDWIDTH=3500000,RESOLUTION=1920x1080,CODECS="avc1.4d401e,mp4a.40.2",AUDIO="aac"
https://statics-01.duckduckcdn.com/${metaID}/videos/1080p.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=2500000,RESOLUTION=1280x720,CODECS="avc1.4d401e,mp4a.40.2",AUDIO="aac"
https://statics-01.duckduckcdn.com/${metaID}/videos/720p.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=800000,RESOLUTION=854x480,CODECS="avc1.4d401e,mp4a.40.2",AUDIO="aac"
https://statics-01.duckduckcdn.com/${metaID}/videos/480p.m3u8`;
  }

  function detectFileType(url) {
    if (url.endsWith('.mpd')) return 'dash';
    if (url.endsWith('.mp4')) return 'mp4';
    return 'hls';
  }

  function buildPlayerConfig(url, subtitleUrl) {
    return {
      file: url,
      type: detectFileType(url),
      autostart: true,
      controls: true,
      stretching: "uniform",
      width: "100%",
      height: "100%",
      crossorigin: 'anonymous',
      captions: {
        position: 'bottom',
        backgroundOpacity: 0,
        color: '#FFFF00'
      },
      tracks: subtitleUrl ? [{
        file: subtitleUrl,
        label: '‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡πÑ‡∏ó‡∏¢',
        kind: 'captions',
        default: true
      }] : []
    };
  }

  let debugEnabled = false;
  function toggleDebug() {
    debugEnabled = !debugEnabled;
    document.getElementById('debug-log').classList.toggle('hidden', !debugEnabled);
    logDebug(`üîß Debug mode: ${debugEnabled ? 'ON' : 'OFF'}`);
  }

  function logDebug(msg) {
    if (!debugEnabled) return;
    const log = document.getElementById('debug-log');
    log.textContent += `${new Date().toLocaleTimeString()} - ${msg}\n`;
  }

  document.addEventListener('DOMContentLoaded', () => {
    const metaID = getQueryParam('metaID');
    const subtitleUrl = getQueryParam('subtitle');
    const movieName = getQueryParam('name');

    const titleElement = document.getElementById('movie-title');
    const errorMessage = document.getElementById('error-message');
    titleElement.textContent = movieName || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á';
    document.title = `‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á | ${movieName || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á'}`;

    if (!metaID) {
      errorMessage.textContent = '‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö metaID ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô';
      errorMessage.classList.remove('hidden');
      return;
    }

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö playlist.m3u8 ‡∏à‡∏≥‡∏•‡∏≠‡∏á
    const playlistUrl = `https://statics-01.duckduckcdn.com/${metaID}/playlist.m3u8`;
    const simulatedContent = buildSimulatedPlaylist(metaID);
    logDebug("üìÑ ‡∏à‡∏≥‡∏•‡∏≠‡∏á playlist.m3u8:\n" + simulatedContent);

    const config = buildPlayerConfig(playlistUrl, subtitleUrl);

    try {
      const player = jwplayer("jwplayerDiv").setup(config);
      player.on('error', e => {
        errorMessage.textContent = `‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${e.message}`;
        errorMessage.classList.remove('hidden');
        logDebug(`Player error: ${e.message}`);
      });
      logDebug("üé¨ JW Player setup complete.");
    } catch (e) {
      errorMessage.textContent = '‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Player';
      errorMessage.classList.remove('hidden');
      logDebug(`Setup exception: ${e.message}`);
    }
  });
</script>

</body>
</html>
