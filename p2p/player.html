<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="referrer" content="no-referrer">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta http-equiv="Cache-Control" content="max-age=3600, public">
  <title>Movie Player</title>
  <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#141414] text-white font-sans">

  <!-- Header -->
  <header class="bg-[#141414] shadow-lg">
    <div class="container mx-auto px-4 py-4 flex justify-start items-center">
      <a href="../movie.html">
        <h1 class="text-3xl font-extrabold text-[#E50914] tracking-wider">
          FLIX <span class="text-white">Movie</span>
        </h1>
      </a>
    </div>
  </header>

  <!-- Main -->
<main class="relative w-full h-screen bg-black overflow-hidden group">

  <!-- VIDEO -->
  <video
    id="my-video"
    class="w-full h-full object-contain bg-black"
    preload="auto">
    <source id="videoSource" src="" type="">
  </video>
<!-- NETFLIX CONTROL BAR -->
<div id="controlBar"
     class="absolute bottom-0 left-0 w-full px-6 pb-6 pt-10 
            bg-gradient-to-t from-black/90 via-black/60 to-transparent
            opacity-100 transition-opacity duration-300 z-40">

  <!-- Progress -->
  <div class="mb-4">
    <input id="progress"
           type="range"
           value="0"
           min="0"
           max="100"
           class="w-full accent-red-600 cursor-pointer">
  </div>

  <!-- Controls Row -->
  <div class="flex items-center justify-between text-white">

    <!-- Left -->
    <div class="flex items-center gap-4">
      <button id="playPause" class="text-2xl">▶</button>

      <span id="timeDisplay" class="text-sm opacity-80">
        00:00 / 00:00
      </span>

      <input id="volume"
             type="range"
             min="0"
             max="1"
             step="0.05"
             value="1"
             class="w-24 accent-white cursor-pointer">
    </div>

    <!-- Right -->
    <div class="flex items-center gap-4">

      <select id="speedControl"
              class="bg-transparent border border-gray-500 rounded px-2 py-1 text-sm">
        <option value="0.5">0.5x</option>
        <option value="1" selected>1x</option>
        <option value="1.5">1.5x</option>
        <option value="2">2x</option>
      </select>

      <button id="fullscreenBtn" class="text-xl">⛶</button>
    </div>

  </div>
</div>
  <!-- Loading Spinner -->
  <div id="loadingSpinner"
       class="absolute inset-0 flex items-center justify-center bg-black z-20">
    <div class="w-14 h-14 border-4 border-red-600 border-t-transparent rounded-full animate-spin"></div>
  </div>

  <!-- Big Play Button -->
  <div id="bigPlay"
       class="absolute inset-0 flex items-center justify-center z-20 cursor-pointer">
    <div class="w-24 h-24 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center hover:scale-110 transition">
      <div class="ml-2 w-0 h-0 border-t-[18px] border-b-[18px] border-l-[28px] border-t-transparent border-b-transparent border-l-white"></div>
    </div>
  </div>

  <!-- Gradient -->
  <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent pointer-events-none"></div>

  <!-- Top Controls -->
  <div id="topBar"
       class="absolute top-0 left-0 w-full flex justify-between items-center p-5 z-30 transition-opacity duration-300 opacity-100">
    <a href="../movie.html"
       class="text-white text-sm font-semibold bg-black/60 px-4 py-2 rounded hover:bg-black">
       ← ย้อนกลับ
    </a>

    <button id="reloadBtn"
       class="text-white text-sm font-semibold bg-red-600/80 px-4 py-2 rounded hover:bg-red-600">
       โหลดซ้ำ
    </button>
  </div>

  <!-- Bottom Info -->
  <div id="bottomBar"
       class="absolute bottom-0 left-0 w-full p-6 z-30 transition-opacity duration-300 opacity-100">
    <h1 id="videoTitle"
        class="text-2xl md:text-4xl font-extrabold text-white drop-shadow-lg">
        กำลังโหลด...
    </h1>
  </div>

  <!-- Skip Intro -->
  <button id="skipIntro"
          class="absolute bottom-24 right-8 bg-white text-black px-4 py-2 rounded font-semibold hidden z-40">
          ข้ามอินโทร
  </button>

  <!-- Next Episode -->
  <button id="nextBtn"
          class="absolute bottom-24 right-8 bg-red-600 text-white px-4 py-2 rounded font-semibold hidden z-40">
          ดูเรื่องถัดไป
  </button>

</main>

<script>
const params = new URLSearchParams(window.location.search);
let file = params.get("file");
let name = params.get("name");

if (file) file = decodeURIComponent(file);
if (name) name = decodeURIComponent(name);

const video = document.getElementById("my-video");
const source = document.getElementById("videoSource");
const title = document.getElementById("videoTitle");

const bigPlay = document.getElementById("bigPlay");
const loadingSpinner = document.getElementById("loadingSpinner");
const topBar = document.getElementById("topBar");
const bottomBar = document.getElementById("bottomBar");
const skipIntro = document.getElementById("skipIntro");
const nextBtn = document.getElementById("nextBtn");

// ตั้งชื่อ
if (name) {
  document.title = name;
  title.textContent = name;
}

// ตั้งค่า source
if (file) {
  source.src = file;
  source.type = file.includes(".m3u8")
    ? "application/x-mpegURL"
    : "video/mp4";
  video.load();
}

// Loading
video.addEventListener("canplay", () => {
  loadingSpinner.style.display = "none";
});

// Big Play
bigPlay.addEventListener("click", () => {
  video.play();
});

video.addEventListener("play", () => {
  bigPlay.style.display = "none";
});

video.addEventListener("pause", () => {
  bigPlay.style.display = "flex";
});

// Auto Hide Controls
let hideTimeout;
function showBars() {
  topBar.style.opacity = "1";
  bottomBar.style.opacity = "1";

  clearTimeout(hideTimeout);
  hideTimeout = setTimeout(() => {
    if (!video.paused) {
      topBar.style.opacity = "0";
      bottomBar.style.opacity = "0";
    }
  }, 3000);
}

document.addEventListener("mousemove", showBars);
document.addEventListener("touchstart", showBars);

// Skip Intro (60 วิแรก)
video.addEventListener("timeupdate", () => {
  if (video.currentTime < 60 && video.currentTime > 5) {
    skipIntro.classList.remove("hidden");
  } else {
    skipIntro.classList.add("hidden");
  }

  // Next ตอนใกล้จบ
  if (video.duration - video.currentTime < 20) {
    nextBtn.classList.remove("hidden");
  } else {
    nextBtn.classList.add("hidden");
  }
});

skipIntro.addEventListener("click", () => {
  video.currentTime = 60;
});

nextBtn.addEventListener("click", () => {
  window.location.href = "../movie.html";
});

// Reload
document.getElementById("reloadBtn").addEventListener("click", (e) => {
  e.preventDefault();
  location.reload();
});
</script>
<script>
const video = document.getElementById("my-video");

const playPause = document.getElementById("playPause");
const progress = document.getElementById("progress");
const volume = document.getElementById("volume");
const timeDisplay = document.getElementById("timeDisplay");
const fullscreenBtn = document.getElementById("fullscreenBtn");
const speedControl = document.getElementById("speedControl");
const controlBar = document.getElementById("controlBar");

// =================
// Play / Pause
// =================
playPause.addEventListener("click", () => {
  if (video.paused) video.play();
  else video.pause();
});

video.addEventListener("play", () => playPause.textContent = "❚❚");
video.addEventListener("pause", () => playPause.textContent = "▶");

// =================
// Progress
// =================
video.addEventListener("timeupdate", () => {
  const percent = (video.currentTime / video.duration) * 100;
  progress.value = percent || 0;

  timeDisplay.textContent =
    formatTime(video.currentTime) + " / " + formatTime(video.duration);
});

progress.addEventListener("input", () => {
  const time = (progress.value / 100) * video.duration;
  video.currentTime = time;
});

// =================
// Volume
// =================
volume.addEventListener("input", () => {
  video.volume = volume.value;
});

// =================
// Speed
// =================
speedControl.addEventListener("change", () => {
  video.playbackRate = parseFloat(speedControl.value);
});

// =================
// Fullscreen
// =================
fullscreenBtn.addEventListener("click", () => {
  if (!document.fullscreenElement) {
    video.requestFullscreen();
  } else {
    document.exitFullscreen();
  }
});

// =================
// Auto Hide
// =================
let hideTimeout;

function showControls() {
  controlBar.style.opacity = "1";

  clearTimeout(hideTimeout);
  hideTimeout = setTimeout(() => {
    if (!video.paused) {
      controlBar.style.opacity = "0";
    }
  }, 3000);
}

document.addEventListener("mousemove", showControls);
document.addEventListener("touchstart", showControls);

// =================
// Format Time
// =================
function formatTime(seconds) {
  if (!seconds) return "00:00";

  const mins = Math.floor(seconds / 60);
  const secs = Math.floor(seconds % 60);
  return `${String(mins).padStart(2, "0")}:${String(secs).padStart(2, "0")}`;
}
</script>
  <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
</body>
</html>
