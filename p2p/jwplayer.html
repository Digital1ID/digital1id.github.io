<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>ดูหนังใหม่ ดูซี่รี่ย์ใหม่</title>

  <!-- Bootstrap + Font -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@200;400;600&display=swap" rel="stylesheet">

  <style>
    body {
      margin: 0;
      font-family: 'Sarabun', sans-serif;
      background-color: #000;
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #play {
      width: 100vw;
      height: 100vh;
    }
    .back-button, .reload-button, .switch-button {
      position: fixed;
      top: 15px;
      z-index: 10000;
      padding: 8px 12px;
      border-radius: 4px;
      text-decoration: none;
      font-size: 14px;
      backdrop-filter: blur(4px);
      transition: background-color 0.3s;
      color: #fff;
    }
    .back-button {
      left: 15px;
      background-color: rgba(255, 255, 255, 0.2);
    }
    .back-button:hover {
      background-color: rgba(255, 255, 255, 0.4);
    }
    .reload-button {
      right: 20px;
      background-color: rgba(0, 123, 255, 0.3);
    }
    .reload-button:hover {
      background-color: rgba(0, 123, 255, 0.6);
    }
    .switch-button {
      left: 20px;
      background-color: rgba(40, 167, 69, 0.3);
    }
    .switch-button:hover { 
      background-color: rgba(40,167,69,0.6); 
    }
    #videoTitle {
      position: fixed;
      bottom: 60px;
      left: 20px;
      color: #fff;
      background: rgba(0,0,0,0.5);
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 16px;
      z-index: 10000;
    }
  </style>
</head>
<body>
  <!--a href="../movie.html" class="back-button">ย้อนกลับ</a-->
  <a href="#" id="switchBtn" class="switch-button">สลับ Player</a>
  <a href="#" id="reloadBtn" class="reload-button">โหลดซ้ำ</a>

  <div id="play"></div>
  <div id="videoTitle"></div>

  <!-- JWPlayer -->
  <script src="jw/jwplayer.js"></script>
<script>
  jwplayer.key = "eNFaXCjyURVoCCGiHp7HTQ3hDhE/AfL0g8VE1fRbL84=";

  const params = new URLSearchParams(window.location.search);
  let file = params.get("file");
  let sub = params.get("subtitle"); 
  let name = params.get("name");

  if (file) file = decodeURIComponent(file);
  if (sub) sub = decodeURIComponent(sub);
  if (name) name = decodeURIComponent(name);

  window.onload = function () {
    if (file) {
      if (name) {
        document.title = name;
        document.getElementById("videoTitle").innerText = name;
      }

      // สร้าง config สำหรับ JWPlayer
      const playerConfig = {
        width: "100%",
        height: "100%",
        aspectratio: "16:9",
        playlist: [{
          sources: [
            { file: file.replace("720p", "480p"), label: "SD", type: file.includes(".m3u8") ? "hls" : "mp4" },
            { file: file.replace("720p", "720p"), label: "HD", type: file.includes(".m3u8") ? "hls" : "mp4" },
            { file: file.replace("720p", "1080p"), label: "Full HD", type: file.includes(".m3u8") ? "hls" : "mp4" }
          ],
          tracks: [] // เตรียม subtitle tracks
        }],
        primary: "html5",
        hlshtml: true,
        crossorigin: "anonymous",
        controls: true,
        autostart: true,
        playbackRateControls: true,
        captions: {
          position: 'bottom',
          backgroundOpacity: 0,
          color: '#FFFFFF'
        }
      };

      // ถ้ามี subtitle ให้เพิ่มเข้าไป
      if (sub && sub.trim() !== '' && sub !== 'undefined') {
        playerConfig.playlist[0].tracks.push({
          file: sub,
          label: 'Thai',
          kind: 'captions',
          default: true
        });
      }

      jwplayer("play").setup(playerConfig);

      // Error Handling
      jwplayer("play").on("error", function(event) {
        document.getElementById("videoTitle").innerHTML = 
  "เกิดข้อผิดพลาดในการโหลดวิดีโอ <a href='#' id='switchBtnError' class='switch-button'>สลับ Player</a>";
        console.error("JWPlayer error:", event);
      });

    } else {
      document.getElementById("videoTitle").innerText = "ไม่พบไฟล์วิดีโอ";
    }
  };

  // reload button
  document.getElementById("reloadBtn").addEventListener("click", (e) => {
    e.preventDefault();
    if (file) {
      jwplayer("play").load([{
        sources: [{
          file: file,
          label: "HD",
          type: file.includes(".m3u8") ? "hls" : "mp4"
        }]
      }]);
      jwplayer("play").play();
    }
  });

  // ปุ่มสลับ Player → ไป videojs.html
  document.getElementById("switchBtn").addEventListener("click", (e) => {
    e.preventDefault();
    const newUrl = new URL(window.location.href);
    newUrl.pathname = newUrl.pathname.replace("jwplayer.html", "videojs.html");
    window.location.href = newUrl.toString();
  });

  document.getElementById("switchBtnError")?.addEventListener("click", (e) => {
  e.preventDefault();
  const newUrl = new URL(window.location.href);
  newUrl.pathname = newUrl.pathname.replace("jwplayer.html", "videojs.html");
  window.location.href = newUrl.toString();
});

</script>
</body>
</html>
